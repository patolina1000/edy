<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Obrigado ❤ | Acesso liberado</title>

  <link rel="canonical" href="https://hadriellemaria.online/obrigado/">
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Obrigado ❤ | Acesso liberado" />
  <meta property="og:description" content="Seu acesso foi liberado. Confirme seu e-mail e siga para o Telegram." />
  <meta property="og:url" content="https://hadriellemaria.online/obrigado/" />
  <meta name="twitter:card" content="summary_large_image" />

  <link rel="dns-prefetch" href="https://connect.facebook.net">
  <link rel="preconnect" href="https://connect.facebook.net" crossorigin>
  <link rel="dns-prefetch" href="https://ipapi.co">
  <link rel="preconnect" href="https://ipapi.co">

  <link rel="stylesheet" href="/theme/overrides.css">
</head>
<body>
  <main class="container">
    <section class="card">
      <div class="hero">
        <img class="avatar-photo" src="/images/perfil.jpg" alt="Hadrielle Maria" width="128" height="128" loading="lazy">
        <div class="ok-badge" aria-hidden="true">✓</div>
        <h1 class="title">Pagamento confirmado!</h1>
        <p class="subtitle">Seu acesso foi liberado. Siga para o Telegram.</p>
        <p class="kv">Transação: <strong id="tx-view">--</strong></p>
      </div>

      <div class="form">
        <form id="accessForm" onsubmit="return false;">
          <label for="emailInput" class="kv">E-mail (opcional, melhora o rastreamento)</label>
          <input id="emailInput" class="input" type="email" placeholder="seu@email.com" />
          <button id="goBtn" class="btn">Ir para o Telegram</button>
        </form>
      </div>

      <p class="note"><small>Você será redirecionado automaticamente após a confirmação.</small></p>
    </section>
  </main>

  <!-- Meta Pixel loader -->
  <script>
    !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
    n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
  </script>

  <script>
    // ====== CONFIG (ajuste URL/redirecionamento/valores se quiser) ======
    const CONFIG = {
      PIXEL_ID: (window.APP_CONFIG && window.APP_CONFIG.PIXEL_ID) || '1280205146659070',
      REDIRECT_URL: 'https://t.me/+KWL7h12wEjADYx',
      VALUE_DEFAULT: 19.90,
      BASE_MS: /Mobi|Android/i.test(navigator.userAgent) ? 6000 : 4000, // 6s mobile / 4s desktop
      EXTEND_MS: 4000,    // +4s se digitar e-mail
      HARD_CAP_MS: 12000, // teto; ajuste para 20000 se quiser 20s
      REDIRECT_ON_FALLBACK: true
    };

    // Init Pixel ANTES de usar fbq
    fbq('init', CONFIG.PIXEL_ID);

    // Obter tx e value
    const params = new URLSearchParams(location.search);
    const tx = (params.get('tx') || sessionStorage.getItem('tx') || ('TX-' + Date.now()));
    const value = parseFloat(params.get('v') || CONFIG.VALUE_DEFAULT);

    // Mostrar tx
    (function(){
      const el = document.getElementById('tx-view');
      if (el && tx) el.textContent = tx;
    })();

    // PageView
    fbq('track','PageView', {}, {eventID: 'pgv:' + Date.now()});

    // AM geo
    (function(){
      const ctl = new AbortController(); const to = setTimeout(()=>ctl.abort(), 800);
      fetch('https://ipapi.co/json', {signal: ctl.signal}).then(r=>r.json()).then(d=>{
        clearTimeout(to);
        const am={}; if(d){ if(d.country)am.ct=d.country; if(d.city)am.cty=d.city; if(d.region)am.st=d.region; if(d.postal)am.zp=d.postal; }
        if(Object.keys(am).length) fbq('set','user',am);
      }).catch(()=>{});
    })();

    // Disparo Purchase
    let fired = false;
    function firePurchase(reason){
      if (fired) return; fired = true;
      fbq('track','Purchase', { value, currency:'BRL', transaction_id: tx }, { eventID: 'pur:' + tx });
      if (CONFIG.REDIRECT_ON_FALLBACK) setTimeout(()=>{ location.href = CONFIG.REDIRECT_URL; }, 800);
    }

    // Timer inteligente
    const emailInput = document.getElementById('emailInput');
    const goBtn = document.getElementById('goBtn');

    let total = CONFIG.BASE_MS;
    if (emailInput) emailInput.addEventListener('input', ()=>{ total = Math.min(CONFIG.HARD_CAP_MS, CONFIG.BASE_MS + CONFIG.EXTEND_MS); });

    if (goBtn) {
      goBtn.addEventListener('click', ()=>{
        const em = (emailInput && emailInput.value || '').trim();
        if (em) fbq('set','user',{ em }); // Pixel hasheia
        firePurchase('cta');
      });
    }

    setTimeout(()=>firePurchase('timer'), total);
  </script>
</body>
</html>

